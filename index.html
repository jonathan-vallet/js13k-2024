<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>13 steps to death</title><style>body,
      html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
        width: 100%;
      }

      body.game {
        .-editor {
          display: none;
        }
      }

      body.editor {
        .-game {
          display: none;
        }
      }

      #game {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      #gBC {
        position: absolute;
        top: -5%;
        left: -5%;
        width: 110%;
        height: 110%;
        z-index: -1;
        object-fit: cover;
        filter: blur(15px) brightness(50%);
      }</style></head><body oncontextmenu="return!1"><div id="game"><canvas id="gBC"></canvas><canvas id="uiCanvas" class="-game"></canvas><canvas id="gC" class="-game"></canvas><div id="editor" class="-editor"><div id="editorUi"><label>Tile: <select id="eTS"></select></label> <label>Orientation: <select id="eOS"><option value="0">Up</option><option value="1">Right</option><option value="2">Down</option><option value="3">Left</option></select></label> <button id="generateJsonButton">Generate JSON</button></div><canvas id="eC"></canvas></div></div><script>!function(){"use strict";let e=e=>document.querySelector(e);const M={blueGreen:["#024d53","#599dbc","#72d1c7","#a9ffe6"],c:["#000","#893a25","#f89e61","#c16c43"],green:["#000","#527f67","#a2ce69","#d6f8e1"],sand:["#e5d09e","#cab168"],bronze:["#000","#811c07","#ca6137","#ffb59c"]},t={arrow:{r:"16LKZLA\\K^LZLBZLBZLLLLLLLLLLLLG",co:M.blueGreen,limit:0,iS:!0},block:{r:"16AXNAMYezeYNZnZNedeNqeYlYeqNqeYgNgYeqNqeYfMeYMfYeqNqeYfMeYMfYeqNqeYeMfZMeYeqNqeYeMeNYMeYeqNqeYeNfNeYeqNqeYlYeqNedeNZnZNYezeYMAXNA",co:M.blueGreen,cCO:!0},"bT":{r:"16AXNAMYezeYNZnZNedeNqeYlYeqNqeYgNgYeqNqeYfMeYMfYeqNqeYfMeYMfYeqNqeYeMfZMeYeqNqeYeMeNYMeYeqNqeYeNfNeYeqNqeYlYeqNedeNZnZNYezeYMAXNA",co:M.green,cCO:!0},boulder:{r:"16LIRHNgqYqNEMgsZrMCMfrYrZsMBMesYqZtMAMfYrYq^qNfZqZuZNerYrYvYN]q[tYNtYs^MAMs[uYMBM\\q[q[MCMtYq\\MENs[NHRE",co:M.c},c:{r:"16AXNANYnYOZVZNeNeqjNeNeMfqetfMeNeMfteqfMeNeNjqeNeNZVZOYnYOYXYO[MZM]OYNYMYNYPYNYMZMYNYMZMYNYPYNYMYNYO]MZM[NAXNA",co:M.c},f:{r:"48DYLCYLCYLBZLBZLBZLCMgLMlGMlGMkHMkHMkHMkHMkHMkHMkHMkHMkHMkHMlGMkHMFfGMLCMChHMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLBZLBZLBZK",co:M.bronze,limit:1},"gong-trigger":{r:"16XQsevesNqfTfqNfOhNgNfNeteNfNfMeqPqeMfMAMeMeqMrMqeMeMBMeMeqPqeMeMBMeNeteNeMBMeMAMhMAMeMBMeMBPBMeMBMeMHMeMBMeMHMeMBMeMAQBMeMBMeMBQAMeMBOHOA",co:M.bronze,iS:!0},gong:{r:"16F\\JZtZGYfvYEZe^rYC\\jYrYB[lYqYBZnZBYhthYBYgq\\qgYBYgqYrYqgYBYgq\\qgYBZgtgZBeZlZeCeZjZeEe`eGlD",co:M.bronze},"hF":{r:"16LLLAMANAMFXNANYnYOZVZNeNeqjNeNeMfqetfMeNeMfteqfMeNeNjqeNeNZVZOYnYOYXYMAM[MZM]MCMAYMYNYNAMLF",co:M.c},h:{r:"16LLLYA\\AYGbEYA`AYDdCYAbAYB\\MYNYM\\A\\MYMZMYM\\AZMYMYNYMYMZCZTZCZMYRYMZCZTZEYTYHRLI",co:["#000","#00506e"]},"kH":{r:"16LFdCYpYAZ{e\\qbe\\qYeYhYeYe\\qZfZfZe\\qYgZgYe\\qYgYhYe\\qZfZfZe\\qYeYhYeYe\\qbe\\oq[edqZpfYAdZA",co:M.blueGreen,limit:0,iS:!0},key:{r:"16FtKqPqIqMhMqHqMYNeMqHqMYNeMqHqM\\MqIqNYMqJqMeYMqJqNYMqJqMZMqKqNqLArLLLLLK",co:M.green},lock:{r:"16FPKMtMIMq\\qMGMZhYqMEMZeqNYeYqMCNYeqPYeYqMAOYeqPYeYrPYfqNYfYrO[eqNYeYfqMYM\\ereYgMYAYM\\fYgMYCYM[MYgMYEYMYMfYeMYGYMhMYIYPYK\\F",co:M.green},rock:{r:"16FPIOhNFMeresfMDMerYeueMCMfqZesfqMBMgqZgYfMBMiYgZNBNYkZqNBNYiZsMBMqgriqMAMqeqYgqMYgMAMYfqMYeqMYgMAMZeqMYfNYfMAOZNYPYMqBPEOLF",co:M.blueGreen,iS:!0},"spawn-current":{r:"16E\\LBYAYJZBYAYJZAYAYJYAYBYBYD[F[AYAYEZCYBZAZB\\AYB\\BYA\\BZAZBYCZEYAYA[F[DYBYBYAYJYAYAZJYAYBZJYAYLB\\E",co:M.blueGreen,limit:1},spawn:{r:"32E\\L\\LBYAYLAYAYJZBYAYIZBYAYJZAYAYJZAYAYJYAYBYBYGYAYBYBYD[F[AYB[F[AYAYEfCYBYAYErCYBZAZBhAYB[AZBtAYB\\BYAhBZA[BYAtBZAZBYCfEYAYBYCrEYAYA[F[BYA[F[DYBYBYAYGYBYBYAYJYAYAZJYAYAZJYAYBZIYAYBZJYAYLAYAYLB\\L\\E",co:M.blueGreen},trap:{r:"16DNANANGVEQfQCNYM[N[NBMeMfYfMfMeMANZM\\e\\OeMfMYgMfMeO]N]OgNgMeYgN\\eYM]eYOeMeOgYfNAeZN[M[MeBNYeMgMfOCO[fZNFQfMJPF",co:["#306710","#000","#b1712e"]},sand:{r:"16ZMYV]MYV]MYW\\MYMYU^MYU^MZU^MZV]MYV]XM\\XM\\X[XN[XM\\X]XZ",co:M.sand,limit:0},characters:{r:"144FPKQLPLLLLLLLLJNhNGNiNHNhNJPKQLPLPKQLPIMlMEMmMFMlMGNhNGNiNHNhNHNhNGNiNHNhNGMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMesereMEMeugMFMlMFMlMEMmMFMlMFMlMEMmMFMlMEMqeveqMEMufNEMqlqMEMereseMEMeugMFMlMFMereseMEMeugMFMlMFMrMrMrMFMqMseMqMFMlMEMqeveqMEMufNEMqlqMDMqeveqMEMufNEMqlqMFMqMrMqMGMqMuMHMjMGMrMrMrMFMqMseMqMFMlMFMrMrMrMFMqMseMqMFMlMFOtOGMtNHOtOFNqMrMqNFMqMuMHNhNGNqMrMqNFMqMuMHNhNFM[P[MGPYMGM[P[MDMZMtMZMFMtNHMZPZMEMZMtMZMFMtOGMZPZMDMZMZrZMZMFN[MFMZM^MZMCOYPYMYqMEQYNFMqM^OCMqYMYPYOFQ[MEO^MqMCMZM^MZMFMYMZMFMZM^MZMCMrM]NqMDMr\\MqMFN]MrMCMqN]MrMEMqNZMYqMEMrM]NEMqTqMGMYMqNGMqTqMEUANEO\\MHUDNAUGN\\MqMFUGN^NHOqMIN^NHMqNZMISHMZNqMIMZNqMJSIMqNZMHMrNrMIMrNJMrNrMJOrMHMrNrMHMrOJMrOJMrNrMJOrMJPKQLPLLLLLLLLJNhNGNiNHNhNJPKQLPLPKQLPIMlMEMmMFNjNGNhNGNiNHNhNHNhNGNiNHNhNGMlMEMmMFMlMFMlMEMmMFNjNFMlMEMmMFNjNFMgqhMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMeveMEMerjMFMlMFMgqhMEMmMFMlMFMgqhMEMmMFMlMEMqeveqMEMshMeMDMqlqMEMeveMEMerjMFMlMFMeveMEMerjMFMlMFMeqMrMqeMFMqMqgMqMeMDMgNgMEMqeveqMEMshMeMDMqlqMDMqeveqMEMshMeMDMqlqMFMqMrMqMGMqMqfrMfMEMeMfMeMGMeqMrMqeMFMqMqgMqMeMDMgNgMFMeqMrMqeMFMqMqgMqMeMDMgNgMGNtNHMtNfMFNhNHMqMrMqMGMqMqfrMfMEMeMfMeMHMqMrMqMGMqMqfrMfMEMeMfMeMGMZPZMHSeMEMYMhMYMFMYMtMYMGMtNfMEMYMhMYMFMYMtMYMGMtNfMEMYMhMYMFM[r[MGMYNYMANFMZMfMZMFMYQYNHSfMDMYMgPFNYQYMGTfMDMYNgOEMqN\\NqMFMZMqMHMqNYNYNqMEO\\MrMFMZqNqODMrNeQEMrM\\OGM[MrOEQeNrMCMrN\\NrMFMYMqMGMrN\\NrMCMrM\\PFMsPFPYNYMrMDP\\MrMEMqMZNqMFMrMYNYPDOrNrOGMrNHOrNrOEOqNrMIOYqMIMrNqOGMrNqOGMrNYNGOqNrMIMqNqMKMqMLMqNqMKOqMJMqNqMJMqOKMqOJMqOqMKOqME",co:["#000","#e42c37","#c07548","#fdcbb0"],limit:0}},r=16,n=13,l=20,o=10,a={f:200,spawn:600},i=225,c=125,Y=300,s=400,N=0,f=1,q=2,h=3,u=[];["-6N-F-N-13N-3N-7N7B/2C/MN7-2G-2N2-6NLN-2N4-2N-6NHN-6E2-20O","-10N-16MC+B+B*-7E-7N-B*-9NPN5-N-5N3-6JE-N-5LJ2-E-4N2-N-5N11HN-2F-2G-5Q5ON"].forEach((e=>{const M=function(e){const M=[];let t=0,r=0,n=0;const o=/([A-Z\-])([+*/]?)(\d*)/g;let a;for(;null!==(a=o.exec(e));){const e=a[1],o=a[2]||"",i=parseInt(a[3]||"1",10),c="-"===e?null:T(e),Y=R(o);for(let e=0;e<i;e++){let e=n%(l-2)+1,o=Math.floor(n/(l-2))+1;c&&("key"===c&&M.push({tile:"kH",x:e,y:o,o:Y}),M.push({tile:c,x:e,y:o,o:Y}),"spawn-current"===c&&(t=e,r=o)),++n}}const i={characterInitialX:t,characterInitialY:r,levelData:M};return i}(e);u.push(M)}));const g={letters:{1:"010110010010111",2:"01101001001001001111",3:"11100001001100011110",4:"00110101100111110001",5:"11111000111100011110",6:"01101000111010010110",7:"11110001001000100010",8:"01101001011010010110",9:"01101001011100010110",0:"01101001100110010110",A:"01101001111110011001",B:"110101110101110",C:"011100100100011",D:"110101101101110",E:"111100111100111",F:"111100111100100",G:"01111000101110010110",H:"10011001111110011001",I:"111010010010111",J:"00010001000110010110",K:"10011010110010101001",L:"100100100100111",M:"1000111011101011000110001",N:"10011101101110011001",O:"01101001100110010110",P:"11101001111010001000",Q:"01101001100110100101",R:"11101001111010101001",S:"01111000011000011110",T:"111010010010010",U:"10011001100110010110",V:"1000110001010100101000100",W:"1010110101101010101001010",X:"10011001011010011001",Y:"10011001111100011110",Z:"11110001011010001111"," ":"000000000000000",",":"000000000001001",".":"000000000000001","!":"010010010000010","/":"0000100010001000100010000",":":"000010000010000",x:"000000101010101"},defaultOptions:{x:0,y:0,text:"",vspacing:10,hspacing:1,color:"rgb(255,255,255)"},textLine:function(e){let M=0;for(let t=0;t<e.text.length;t++){const r=e.text.charAt(t),n=this.letters[r]||this.letters.unknown,l=n.length/5;for(let r=0;r<5;r++)for(let o=0;o<l;o++){"1"===n[r*l+o]&&e.ctx.rect((e.x+(o+M+e.hspacing*t))*p,(e.y+r)*p,p,p)}M+=l}},text:function(e){const M={ctx:L,...this.defaultOptions,...e},t=M.text.split("\n"),r=5*p;M.ctx.beginPath();for(let e=0;e<t.length;e++){const n=t[e],l=M.x,o=M.y+(r+M.vspacing*p)*e;g.textLine({ctx:M.ctx,x:l,y:o,text:n,hspacing:M.hspacing})}M.ctx.fillStyle=M.color,M.ctx.fill()}},d=e("#uiCanvas"),Z=d.getContext("2d"),A=e("#gC"),L=A.getContext("2d"),F=e("#gBC"),E=F.getContext("2d"),B=e("#eC"),m=B.getContext("2d");let x=A,C=L,b="game",p=1,w=0,O=[],k=0;const y=[];let v=0,G=e("#eTS"),H=e("#eOS"),D={x:-1,y:-1},P=(...e)=>J(I(...e)),J=(...e)=>{let M=Q.createBufferSource(),t=Q.createBuffer(e.length,e[0].length,X);return e.map(((e,M)=>t.getChannelData(M).set(e))),M.buffer=t,M.connect(Q.destination),M.start(),M},I=(e=1,M=.05,t=220,r=0,n=0,l=.1,o=0,a=1,i=0,c=0,Y=0,s=0,N=0,f=0,q=0,h=0,u=0,g=1,d=0,Z=0)=>{let A,L,F=2*Math.PI,E=i*=500*F/X**2,B=(0<q?1:-1)*F/4,m=t*=(1+2*M*Math.random()-M)*F/X,x=[],C=0,b=0,p=0,w=1,O=0,k=0,y=0;for(c*=500*F/X**3,q*=F/X,Y*=F/X,s*=X,N=X*N|0,L=(r=99+X*r)+(d*=X)+(n*=X)+(l*=X)+(u*=X)|0;p<L;x[p++]=y)++k%(100*h|0)||(y=o?1<o?2<o?3<o?Math.sin((C%F)**3):Math.max(Math.min(Math.tan(C),1),-1):1-(2*C/F%2+2)%2:1-4*Math.abs(Math.round(C/F)-C/F):Math.sin(C),y=(N?1-Z+Z*Math.sin(2*Math.PI*p/N):1)*(0<y?1:-1)*Math.abs(y)**a*e*S*(p<r?p/r:p<r+d?1-(p-r)/d*(1-g):p<r+d+n?g:p<L-u?(L-p-u)/l*g:0),y=u?y/2+(u>p?0:(p<L-u?1:(L-p)/u)*x[p-u|0]/2):y),A=(t+=i+=c)*Math.sin(b*q-B),C+=A-A*f*(1-1e9*(Math.sin(p)+1)%2),b+=A-A*f*(1-1e9*(Math.sin(p)**2+1)%2),w&&++w>s&&(t+=Y,m+=Y,w=0),!N||++O%N||(t=m,i=E,w=w||1);return x},S=.3,X=44100,Q=new(window.AudioContext||webkitAudioContext),K=[];function j(e){const M=function(e){const M="A".charCodeAt(0),t=[],r=parseInt(e.match(/^\d+/)[0],10);e=e.replace(/^\d+/,"");for(let r=0;r<e.length;++r){const n=e[r].charCodeAt(0)-M,l=Math.floor(n/12),o=n%12+1;t.push(...Array(o).fill(l))}return{pixels:t,imageWidth:r}}(t[e].r);K=M.pixels;const r=function(e,M){const t=[];for(let r=0;r<e.length;r+=M)t.push(e.slice(r,r+M));return t}(M.pixels,M.imageWidth),n=function(e,M,t){const r=[],n=e.length,l=e[0].length;for(let o=0;o<n;o+=t)for(let n=0;n<l;n+=M){const l=[];for(let r=0;r<t;r++)l.push(e[o+r].slice(n,n+M));r.push(l)}return r}(r,16,16);return n}function R(e){switch(e){case"+":return 1;case"*":return 2;case"/":return 3;default:return 0}}function T(e){return Object.keys(t)[e.charCodeAt(0)-"A".charCodeAt(0)]}function z(e){let M="",t="",r="",n=0;for(let e=1;e<=o-2;e++)for(let o=1;o<=l-2;o++){const l=le(o,e),a=V(l?.tile),i=U(l?.o);a===t&&i===r?++n:(M+=t+r,n>1&&(M+=`${n}`),t=a,r=i,n=1)}return M+=t+r,n>1&&(M+=`${n}`),M=M.replace(/-[0-9]+$/,""),M}function T(e){return Object.keys(t)[e.charCodeAt(0)-"A".charCodeAt(0)]}function V(e){if(!e)return"-";const M=Object.keys(t).indexOf(e);return String.fromCharCode("A".charCodeAt(0)+M)}function U(e){return{1:"+",2:"*",3:"/"}[e]||""}function W(){var e;e=v,C.drawImage(F,0,0,A.width,A.height),_(u[e].levelData),function(){Z.fillStyle="#333",Z.fillRect(0,0,d.width,d.height),g.text({ctx:Z,x:10,y:7,text:"STEPS:",color:"rgb(255,255,255)"});let e=0,M=0;if(Se>=10){const t=Se-9;e=Ne(t),M=Ne(t)}g.text({ctx:Z,x:40+e,y:7+M,text:`${Se}`,color:fe(Se)});const r=t.key.tiles[0],n=t.key.co||["#000","#f00","#0f0","#00f"];ee(r,n,4.5,.2,{context:Z}),g.text({ctx:Z,x:120,y:7,text:`LEVEL: ${v+1}`,color:"rgb(255,255,255)"}),g.text({ctx:Z,x:90,y:7,text:`x${w}`,color:"rgb(255,255,255)"}),g.text({ctx:Z,x:270,y:7,text:"R: RESET",color:"rgb(255,255,255)"})}(),"editor"===b?Ue():function(){const e=t.characters.tiles[be],M=t.characters.co;ee(e,M,Fe,Ee,{scale:de,flipHorizontally:Ze===f})}()}function $(e,M){const r=t[e].tiles[0],n=t[e].co,a=t[M].tiles[0],i=t[M].co;for(let e=0;e<o;e++)for(let M=0;M<l;M++)ee(r,n,M,e),0!==M&&M!==l-1&&0!==e&&e!==o-1||ee(a,i,M,e);console.log(u[v],v),_(u[v].levelData,!0),E.drawImage(x,0,0,F.width,F.height)}function _(e,M=!1){e.forEach((e=>{const r=t[e.tile];if("game"==b&&(M&&!r.iS||!M&&r.iS))return;ee(r.tiles[e.animationFrame||0],e.color||t[e.tile].co,e.x,e.y,{o:e.o||N,scale:e.scale||1})}))}function ee(e,M,t,n,l={}){const{o:o=N,scale:a=e.scale||1,context:i=C,flipHorizontally:c=!1,alpha:Y=1}=l;i.save();const s=r*p/2;i.translate(Math.floor((t+.5)*r*p),Math.floor((n+.5)*r*p));let f=1;c&&(f=-1),i.scale(a*f,a),i.rotate(o*Math.PI/2),i.translate(-s,-s);for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length;r++){const n=e[t][r];n>0&&(i.fillStyle=M[n-1],i.globalAlpha=Y,i.fillRect(r*p,t*p,p,p))}i.restore()}function Me(e){v=e,u[v].initialData=JSON.parse(JSON.stringify(u[v].levelData)),re()}function te(){u[v].levelData=JSON.parse(JSON.stringify(u[v].initialData)),re(),Se=0,O=[]}function re(){Ae=u[v].characterInitialX,Le=u[v].characterInitialY,Fe=Ae,Ee=Le,Ke(q),de=1}function ne(e,M){return e>=1&&e<l-1&&M>=1&&M<o-1}function le(e,M,t=[],r=v){let n=null,l=u[r].levelData;for(const r of l)r.x===e&&r.y===M&&(t.length>0?t.includes(r.tile)&&(n=r):n=r);return n}function oe(e,M,t){u[v].levelData=u[v].levelData.filter((r=>r.tile!==e||r.x!==M||r.y!==t))}function ae(e,M,t,r={}){u[v].levelData.push({tile:e,x:M,y:t,...r})}function ie(e,M,t,r,n){let o=1;"boulder"===e&&(o=l);let a=0;for(;a<o;){let e=M+(a+1)*r,l=t+(a+1)*n,o=le(e,l)?.tile||null;if(!ne(e,l)||null!==o&&!["arrow","h","trap","hF"].includes(o))break;a++}if(a>0){let l=u[v].levelData;for(const o of l)if(o.x===M&&o.y===t&&o.tile===e){ce(o,M+a*r,t+a*n);for(let M=1;M<a;M++)setTimeout((()=>{ze(e)}),c*M);return!0}}return!1}function ce(e,M,t){Be=e,qe=e.x,he=e.y,ue=M,ge=t,me=0}function Ye(e,M,t,r){se("bT",e,M),se("block",e,M),ze("block");const n=e+t,l=M+r,o=le(n,l)?.tile;if("block"===o){const e=u[v].levelData.find((e=>e.x===n&&e.y===l&&"block"===e.tile));if(e){const M=e.o||N;let t=0,r=0;M===h?t=-1:M===f?t=1:M===N?r=-1:M===q&&(r=1),setTimeout((()=>{Ye(n,l,t,r)}),120)}}}function se(e,M=null,t=null,r,n=i){u[v].levelData.filter((r=>r.tile===e&&(null===M||r.x===M&&r.y===t))).forEach((e=>{e.isBeingRemoved=!0,e.scale=1,e.elapsed=0,e.removalDuration=n,e.removeCallback=r}))}function Ne(e){const M=.5*e;return Math.random()*M-M/2}function fe(e){return e<11?"rgb(255, 255, 255)":e<12?"rgb(255, 255, 0)":e<13?"rgb(255, 165, 0)":"rgb(255, 0, 0)"}!function(){for(const e in t)t[e].tiles=j(e)}();let qe,he,ue,ge,de,Ze,Ae,Le,Fe,Ee,Be=null,me=0;function xe(e,M,t,r,n){let l=!1;switch(n?.tile){case"c":case"boulder":ie(n?.tile,e,M,t,r)&&(l=!0);break;case"lock":w>0&&(l=!0,se("lock",e,M,(()=>{w--})));break;case"f":return te(),!1;case"bT":const o=n.o||N;(o===h&&-1===t||o===f&&1===t||o===N&&-1===r||o===q&&1===r)&&(Ye(e,M,t,r),l=!0);break;case"gong-trigger":n.triggered||(n.triggered=!0,l=!0,se("gong"))}return l}function Ce(e){switch(e){case"ArrowUp":case"z":case"w":return"up";case"ArrowDown":case"s":return"down";case"ArrowLeft":case"q":case"a":return"left";case"ArrowRight":case"d":return"right";default:return null}}window.addEventListener("keydown",(function(e){const M=Ce(e.key);M&&!y.includes(M)&&y.push(M)})),window.addEventListener("keyup",(function(e){const M=Ce(e.key);if(M){const e=y.indexOf(M);-1!==e&&y.splice(e,1)}"r"===e.key&&te(),Te=!1}));let be,pe,we,Oe,ke,ye,ve,Ge,He=!1,De=Fe,Pe=Ee,Je=Fe,Ie=Ee,Se=0;function Xe(e,M,t){if(we||He||Be)return;const r=Fe+e,l=Ee+M;let o=Ze;Ke(t),function(e,M,t=0,r=0){if(Be||He||we)return!1;if(!ne(e,M))return ze("wall"),!1;const n=le(e,M),l=n?.tile||null;if(n&&n.isBeingRemoved)return!1;let o=xe(e,M,t,r,n);return o&&ze(l),!![null,"arrow","key","kH","f","trap","h","hF","spawn","spawn-current"].includes(l)||(o?(++Se,Te=!0,Re(Fe,Ee,o)):ze("wall"),!1)}(r,l,e,M)&&(Se<n&&(He=!0,De=Fe,Pe=Ee,Je=r,Ie=l,pe=0,O.push({x:Fe,y:Ee,o:o})),Se=Math.min(Se+1,n))}function Qe(e=null,M=null){we=!0,ke=Fe,ye=Ee,ve=e||Ae,Ge=M||Le,Oe=performance.now()}function Ke(e){Ze=e,be=je(Ze)}function je(e){switch(e){case N:return 2;case f:case h:return 1;case q:return 0}}function Re(e,M,t){const r=le(e,M,["trap"]);if("trap"===r?.tile)t||(ze("trap"),r.tile="h");const l=le(Fe,Ee,["key","h","spawn","spawn-current"]);switch(l?.tile){case"h":Qe(O[O.length-1].x,O[O.length-1].y),--Se;break;case"spawn-current":Se=0;break;case"spawn":le(Ae,Le).tile="spawn",l.tile="spawn-current",l.animationFrame=0,l.elapsed=0,Ae=Fe,Le=Ee,Se=0;break;case"key":oe("key",Fe,Ee),ze("key"),++w}Se>=n&&(Qe(),setTimeout((()=>{Se=0}),s))}let Te=!1;function ze(e){switch(e){case"gong-trigger":P(...[,0,523.2511,.02,,1.5,1,.5,-.05,.5,,,.3,.05,,,.05,.8,,.05]);break;case"block":P(...[,0,146.8324,.1,,0,,,,,,,,4,,,,0,.2]);break;case"boulder":P(...[,0,73.41619,.1,,0,,,,,,,,4,,,,0,.2]);break;case"c":P(...[,0,146.8324,.05,,.05,,1.3,,,,,,3]);break;case"key":P(...[,0,1320,,.06,.3,1,,,,880,.06]);break;case"lock":P(...[,0,440,.1,,,1,.3,,,-110,.15,,,,,,,.1]);break;case"trap":P(...[.5,0,440,.08,,.2,4,2,,,,,,5]);break;case"wall":Te||(Te=!0,P(...[,0,440,.15,.01,.12,1,1.59,-6.98,4.97]))}}let Ve=!1;function Ue(){const e=G.value,M=parseInt(H.value);ee(t[e].tiles[0],t[e].co,D.x,D.y,{o:t[e].cCO?M:N,scale:1,context:m,flipHorizontally:!1,alpha:.5})}function We(e){if(1===e.buttons){if(!le(D.x,D.y)&&ne(D.x,D.y)){ae(G.value,D.x,D.y,{o:t[G.value].cCO?parseInt(H.value):N});z(u[v].levelData)}}else if(2===e.buttons){oe(G.value,D.x,D.y);z(u[v].levelData)}}function $e(){p=Math.min(Math.floor(window.innerWidth/(l*r)),Math.floor(.89*window.innerHeight/(o*r))),A.width=l*r*p,A.height=o*r*p,B.width=A.width,B.height=A.height,d.width=A.width,d.height=1.1*r*p,window.innerWidth/window.innerHeight>l/o?(F.width=window.innerWidth,F.height=window.innerWidth*(o/l)):(F.height=window.innerHeight,F.width=window.innerHeight*(l/o))}var _e;B.addEventListener("mousemove",(e=>{if(e.preventDefault(),"editor"===b){const M=B.getBoundingClientRect(),t=e.clientX-M.left,n=e.clientY-M.top;D.x=Math.floor(t/(r*p)),D.y=Math.floor(n/(r*p)),Ue(),Ve&&We(e)}})),B.addEventListener("mousewheel",(e=>{if("editor"===b){e.preventDefault();const M=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));H.value=(parseInt(H.value)+M+4)%4,Ue()}})),B.addEventListener("mousedown",(e=>{Ve=!0,We(e)})),B.addEventListener("mouseup",(e=>{Ve=!1})),window.addEventListener("resize",(()=>{$e(),$("sand","rock")})),$e(),_e=b,document.body.classList.remove(b),document.body.classList.add(_e),b=_e,C="game"===_e?L:m,x="game"===_e?A:B,"game"===_e?(L.imageSmoothingEnabled=!1,$("sand","rock"),Me(v)):(m.imageSmoothingEnabled=!1,v=0,$("sand","rock"),Me(v),Object.keys(t).forEach((e=>{if(0!==t[e].limit){let M=document.createElement("option");M.value=e,M.text=e,G.appendChild(M)}}))),requestAnimationFrame((function e(M){!function(e){if(u[v].levelData.forEach((M=>{if(t[M.tile].tiles.length>1){M.elapsed=(M.elapsed||0)+e;const r=a[M.tile];M.elapsed>=r&&(M.animationFrame=(M.animationFrame+1)%t[M.tile].tiles.length||0,M.elapsed=0)}if(M.isBeingRemoved){M.elapsed=(M.elapsed||0)+e;const t=M.removalDuration||i;M.scale=Math.max(1-M.elapsed/t,0),M.scale<=0&&(oe(M.tile,M.x,M.y),M.removeCallback&&M.removeCallback())}})),!He&&!we&&y.length>0){switch(y[y.length-1]){case"up":Xe(0,-1,N);break;case"down":Xe(0,1,q);break;case"left":Xe(-1,0,h);break;case"right":Xe(1,0,f)}}He&&function(e){pe+=e;const M=Math.min(pe/Y,1);Fe=De+(Je-De)*M,Ee=Pe+(Ie-Pe)*M;let t=je(Ze);switch(Math.floor(3*M)){case 0:be=t+3;break;case 1:be=t;break;case 2:be=t+6}M>=1&&(He=!1,Fe=Je,Ee=Ie,pe=0,be=t,Re(De,Pe))}(e);Be&&function(e){me+=e;const M=Math.abs(qe-ue)+Math.abs(he-ge);let t=c*M;const r=Math.min(me/t,1);if("boulder"===Be.tile){const e=4,t=M*e,n=Math.floor(r*t)%e;Be.o=n}Be.x=qe+(ue-qe)*r,Be.y=he+(ge-he)*r,r>=1&&(Be.x=ue,Be.y=ge,me=0,"c"===Be.tile&&function(e){const M=le(e.x,e.y,["h","trap"]);M&&(oe(M.tile,e.x,e.y),oe("c",e.x,e.y),ae("hF",e.x,e.y),ze("fall"))}(Be),Be=null)}(e)}(M-k),we&&function(){const e=performance.now()-Oe,M=Math.min(e/s,1);M<.5?(de=1-2*M,Fe=ke,Ee=ye):(de=2*(M-.5),Fe=ve,Ee=Ge,ve===Ae&&Ge===Le&&Ke(q));M>=1&&(we=!1,Fe=ve,Ee=Ge,de=1)}(),W(),k=M,requestAnimationFrame(e)}))}();</script></body></html>