<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>13 steps to death</title><style>body,
      html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
        width: 100%;
      }

      body:not(.game) {
        .-game {
          display: none;
        }
      }
      body:not(.editor) {
        .-editor {
          display: none;
        }
      }

      #game {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      #gBC {
        position: absolute;
        top: -5%;
        left: -5%;
        width: 110%;
        height: 110%;
        z-index: -1;
        object-fit: cover;
        filter: blur(15px) brightness(50%);
      }</style></head><body oncontextmenu="return!1"><div id="game"><canvas id="gBC"></canvas><canvas id="uiCanvas" class="-game"></canvas><div id="editor" class="-editor"><div id="editorUi"><label>Tile: <select id="eTS"></select></label> <label>Orientation: <select id="eOS"><option value="0">Up</option><option value="1">Right</option><option value="2">Down</option><option value="3">Left</option></select></label> <button id="generateJsonButton">Generate JSON</button></div></div><canvas id="gC"></canvas><script>!function(){"use strict";let e=e=>document.querySelector(e);const M={blueGreen:["#024d53","#599dbc","#72d1c7","#a9ffe6"],c:["#000","#893a25","#f89e61","#c16c43"],green:["#000","#527f67","#a2ce69","#d6f8e1"],sand:["#e5d09e","#cab168"],bronze:["#000","#811c07","#ca6137","#ffb59c"]},t={arrow:{r:"16LKZLA\\K^LZLBZLBZLLLLLLLLLLLLG",co:M.blueGreen,limit:0,iS:!0},block:{r:"16AXNAMYezeYNZnZNedeNqeYlYeqNqeYgNgYeqNqeYfMeYMfYeqNqeYfMeYMfYeqNqeYeMfZMeYeqNqeYeMeNYMeYeqNqeYeNfNeYeqNqeYlYeqNedeNZnZNYezeYMAXNA",co:M.blueGreen,cCO:!0},"bT":{r:"16AXNAMYezeYNZnZNedeNqeYlYeqNqeYgNgYeqNqeYfMeYMfYeqNqeYfMeYMfYeqNqeYeMfZMeYeqNqeYeMeNYMeYeqNqeYeNfNeYeqNqeYlYeqNedeNZnZNYezeYMAXNA",co:M.green,cCO:!0},boulder:{r:"16LIRHNgqYqNEMgsZrMCMfrYrZsMBMesYqZtMAMfYrYq^qNfZqZuZNerYrYvYN]q[tYNtYs^MAMs[uYMBM\\q[q[MCMtYq\\MENs[NHRE",co:M.c},c:{r:"16AXNANYnYOZVZNeNeqjNeNeMfqetfMeNeMfteqfMeNeNjqeNeNZVZOYnYOYXYO[MZM]OYNYMYNYPYNYMZMYNYMZMYNYPYNYMYNYO]MZM[NAXNA",co:M.c},f:{r:"48DYLCYLCYLBZLBZLBZLCMgLMlGMlGMkHMkHMkHMkHMkHMkHMkHMkHMkHMkHMlGMkHMFfGMLCMChHMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLBZLBZLBZK",co:M.bronze,limit:1},"gong-trigger":{r:"16XQsevesNqfTfqNfOhNgNfNeteNfNfMeqPqeMfMAMeMeqMrMqeMeMBMeMeqPqeMeMBMeNeteNeMBMeMAMhMAMeMBMeMBPBMeMBMeMHMeMBMeMHMeMBMeMAQBMeMBMeMBQAMeMBOHOA",co:M.bronze,iS:!0},gong:{r:"16F\\JZtZGYfvYEZe^rYC\\jYrYB[lYqYBZnZBYhthYBYgq\\qgYBYgqYrYqgYBYgq\\qgYBZgtgZBeZlZeCeZjZeEe`eGlD",co:M.bronze},"hF":{r:"16LLLAMANAMFXNANYnYOZVZNeNeqjNeNeMfqetfMeNeMfteqfMeNeNjqeNeNZVZOYnYOYXYMAM[MZM]MCMAYMYNYNAMLF",co:M.c},h:{r:"16LLLYA\\AYGbEYA`AYDdCYAbAYB\\MYNYM\\A\\MYMZMYM\\AZMYMYNYMYMZCZTZCZMYRYMZCZTZEYTYHRLI",co:["#000","#00506e"]},"kH":{r:"16LFdCYpYAZ{e\\qbe\\qYeYhYeYe\\qZfZfZe\\qYgZgYe\\qYgYhYe\\qZfZfZe\\qYeYhYeYe\\qbe\\oq[edqZpfYAdZA",co:M.blueGreen,limit:0,iS:!0},key:{r:"16FtKqPqIqMhMqHqMYNeMqHqMYNeMqHqM\\MqIqNYMqJqMeYMqJqNYMqJqMZMqKqNqLArLLLLLK",co:M.green},lock:{r:"16FPKMtMIMq\\qMGMZhYqMEMZeqNYeYqMCNYeqPYeYqMAOYeqPYeYrPYfqNYfYrO[eqNYeYfqMYM\\ereYgMYAYM\\fYgMYCYM[MYgMYEYMYMfYeMYGYMhMYIYPYK\\F",co:M.green},rock:{r:"16FPIOhNFMeresfMDMerYeueMCMfqZesfqMBMgqZgYfMBMiYgZNBNYkZqNBNYiZsMBMqgriqMAMqeqYgqMYgMAMYfqMYeqMYgMAMZeqMYfNYfMAOZNYPYMqBPEOLF",co:M.blueGreen,iS:!0},"spawn-current":{r:"16E\\LBYAYJZBYAYJZAYAYJYAYBYBYD[F[AYAYEZCYBZAZB\\AYB\\BYA\\BZAZBYCZEYAYA[F[DYBYBYAYJYAYAZJYAYBZJYAYLB\\E",co:M.blueGreen,limit:1},spawn:{r:"32E\\L\\LBYAYLAYAYJZBYAYIZBYAYJZAYAYJZAYAYJYAYBYBYGYAYBYBYD[F[AYB[F[AYAYEfCYBYAYErCYBZAZBhAYB[AZBtAYB\\BYAhBZA[BYAtBZAZBYCfEYAYBYCrEYAYA[F[BYA[F[DYBYBYAYGYBYBYAYJYAYAZJYAYAZJYAYBZIYAYBZJYAYLAYAYLB\\L\\E",co:M.blueGreen},trap:{r:"16DNANANGVEQfQCNYM[N[NBMeMfYfMfMeMANZM\\e\\OeMfMYgMfMeO]N]OgNgMeYgN\\eYM]eYOeMeOgYfNAeZN[M[MeBNYeMgMfOCO[fZNFQfMJPF",co:["#306710","#000","#b1712e"]},sand:{r:"16ZMYV]MYV]MYW\\MYMYU^MYU^MZU^MZV]MYV]XM\\XM\\X[XN[XM\\X]XZ",co:M.sand,limit:0},characters:{r:"144FPKQLPLLLLLLLLJNhNGNiNHNhNJPKQLPLPKQLPIMlMEMmMFMlMGNhNGNiNHNhNHNhNGNiNHNhNGMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMesereMEMeugMFMlMFMlMEMmMFMlMFMlMEMmMFMlMEMqeveqMEMufNEMqlqMEMereseMEMeugMFMlMFMereseMEMeugMFMlMFMrMrMrMFMqMseMqMFMlMEMqeveqMEMufNEMqlqMDMqeveqMEMufNEMqlqMFMqMrMqMGMqMuMHMjMGMrMrMrMFMqMseMqMFMlMFMrMrMrMFMqMseMqMFMlMFOtOGMtNHOtOFNqMrMqNFMqMuMHNhNGNqMrMqNFMqMuMHNhNFM[P[MGPYMGM[P[MDMZMtMZMFMtNHMZPZMEMZMtMZMFMtOGMZPZMDMZMZrZMZMFN[MFMZM^MZMCOYPYMYqMEQYNFMqM^OCMqYMYPYOFQ[MEO^MqMCMZM^MZMFMYMZMFMZM^MZMCMrM]NqMDMr\\MqMFN]MrMCMqN]MrMEMqNZMYqMEMrM]NEMqTqMGMYMqNGMqTqMEUANEO\\MHUDNAUGN\\MqMFUGN^NHOqMIN^NHMqNZMISHMZNqMIMZNqMJSIMqNZMHMrNrMIMrNJMrNrMJOrMHMrNrMHMrOJMrOJMrNrMJOrMJPKQLPLLLLLLLLJNhNGNiNHNhNJPKQLPLPKQLPIMlMEMmMFNjNGNhNGNiNHNhNHNhNGNiNHNhNGMlMEMmMFMlMFMlMEMmMFNjNFMlMEMmMFNjNFMgqhMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMeveMEMerjMFMlMFMgqhMEMmMFMlMFMgqhMEMmMFMlMEMqeveqMEMshMeMDMqlqMEMeveMEMerjMFMlMFMeveMEMerjMFMlMFMeqMrMqeMFMqMqgMqMeMDMgNgMEMqeveqMEMshMeMDMqlqMDMqeveqMEMshMeMDMqlqMFMqMrMqMGMqMqfrMfMEMeMfMeMGMeqMrMqeMFMqMqgMqMeMDMgNgMFMeqMrMqeMFMqMqgMqMeMDMgNgMGNtNHMtNfMFNhNHMqMrMqMGMqMqfrMfMEMeMfMeMHMqMrMqMGMqMqfrMfMEMeMfMeMGMZPZMHSeMEMYMhMYMFMYMtMYMGMtNfMEMYMhMYMFMYMtMYMGMtNfMEMYMhMYMFM[r[MGMYNYMANFMZMfMZMFMYQYNHSfMDMYMgPFNYQYMGTfMDMYNgOEMqN\\NqMFMZMqMHMqNYNYNqMEO\\MrMFMZqNqODMrNeQEMrM\\OGM[MrOEQeNrMCMrN\\NrMFMYMqMGMrN\\NrMCMrM\\PFMsPFPYNYMrMDP\\MrMEMqMZNqMFMrMYNYPDOrNrOGMrNHOrNrOEOqNrMIOYqMIMrNqOGMrNqOGMrNYNGOqNrMIMqNqMKMqMLMqNqMKOqMJMqNqMJMqOKMqOJMqOqMKOqME",co:["#000","#e42c37","#c07548","#fdcbb0"],limit:0}},n=16,r=13,l=20,i=10,o={f:200,spawn:600},a=225,c=125,s=300,Y=400,N=0,f=1,q=2,h=3,u=[];["-6N-F-N-13N-3N-7N7B/2C/MN7-2GA/-N2-6NLN-2N4-2N-6NHN-6E2-17A-2O","-10N-16MC+B+B*-7E-7N-B*-9NPN5-N-5N3-6JE-N-5LJ2-E-4N2-N-5N11HN-2F-2G-5Q5ON"].forEach((e=>{const M=function(e){const M=[];let t=0,n=0,r=0;const i=/([A-Z\-])([+*/]?)(\d*)/g;let o;for(;null!==(o=i.exec(e));){const e=o[1],i=o[2]||"",a=parseInt(o[3]||"1",10),c="-"===e?null:Q(e),s=X(i);for(let e=0;e<a;e++){let e=r%(l-2)+1,i=Math.floor(r/(l-2))+1;c&&("key"===c&&M.push({tile:"kH",x:e,y:i,o:s}),M.push({tile:c,x:e,y:i,o:s}),"spawn-current"===c&&(t=e,n=i)),++r}}const a={characterInitialX:t,characterInitialY:n,levelData:M};return a}(e);u.push(M)}));const g={letters:{1:"010110010010111",2:"01101001001001001111",3:"11100001001100011110",4:"00110101100111110001",5:"11111000111100011110",6:"01101000111010010110",7:"11110001001000100010",8:"01101001011010010110",9:"01101001011100010110",0:"01101001100110010110",A:"01101001111110011001",B:"110101110101110",C:"011100100100011",D:"110101101101110",E:"111100111100111",F:"111100111100100",G:"01111000101110010110",H:"10011001111110011001",I:"111010010010111",J:"00010001000110010110",K:"10011010110010101001",L:"100100100100111",M:"1000111011101011000110001",N:"10011101101110011001",O:"01101001100110010110",P:"11101001111010001000",Q:"01101001100110100101",R:"11101001111010101001",S:"01111000011000011110",T:"111010010010010",U:"10011001100110010110",V:"1000110001010100101000100",W:"1010110101101010101001010",X:"10011001011010011001",Y:"10011001111100011110",Z:"11110001011010001111"," ":"000000000000000",",":"000000000001001",".":"000000000000001","!":"010010010000010","/":"0000100010001000100010000",":":"000010000010000",x:"000000101010101"},defaultOptions:{x:0,y:0,scale:1,text:"",vspacing:10,hspacing:1,color:"rgb(255,255,255)"},textLine:function(e){let M=0;for(let t=0;t<e.text.length;t++){const n=e.text.charAt(t),r=this.letters[n]||this.letters.unknown,l=r.length/5;for(let n=0;n<5;n++)for(let i=0;i<l;i++){"1"===r[n*l+i]&&e.ctx.rect((e.x+(i+M+e.hspacing*t))*m,(e.y+n)*m,m,m)}M+=l}},text:function(e){const M={ctx:E,...this.defaultOptions,...e},t=M.text.split("\n"),n=5*m*M.scale;M.ctx.beginPath();for(let e=0;e<t.length;e++){const r=t[e],l=M.x,i=M.y+(n+M.vspacing*m)*e;g.textLine({ctx:M.ctx,x:l,y:i,text:r,hspacing:M.hspacing})}M.ctx.fillStyle=M.color,M.ctx.fill()}},d=e("#uiCanvas"),Z=d.getContext("2d"),A=e("#gC"),E=A.getContext("2d"),L=e("#gBC"),F=L.getContext("2d");let b="game";b="menu";let m=1,x=0,B=[],w=0;const p=[];let C=0,k=e("#eTS"),O=e("#eOS"),y={x:-1,y:-1},v=(...e)=>D(G(...e)),D=(...e)=>{let M=J.createBufferSource(),t=J.createBuffer(e.length,e[0].length,P);return e.map(((e,M)=>t.getChannelData(M).set(e))),M.buffer=t,M.connect(J.destination),M.start(),M},G=(e=1,M=.05,t=220,n=0,r=0,l=.1,i=0,o=1,a=0,c=0,s=0,Y=0,N=0,f=0,q=0,h=0,u=0,g=1,d=0,Z=0)=>{let A,E,L=2*Math.PI,F=a*=500*L/P**2,b=(0<q?1:-1)*L/4,m=t*=(1+2*M*Math.random()-M)*L/P,x=[],B=0,w=0,p=0,C=1,k=0,O=0,y=0;for(c*=500*L/P**3,q*=L/P,s*=L/P,Y*=P,N=P*N|0,E=(n=99+P*n)+(d*=P)+(r*=P)+(l*=P)+(u*=P)|0;p<E;x[p++]=y)++O%(100*h|0)||(y=i?1<i?2<i?3<i?Math.sin((B%L)**3):Math.max(Math.min(Math.tan(B),1),-1):1-(2*B/L%2+2)%2:1-4*Math.abs(Math.round(B/L)-B/L):Math.sin(B),y=(N?1-Z+Z*Math.sin(2*Math.PI*p/N):1)*(0<y?1:-1)*Math.abs(y)**o*e*H*(p<n?p/n:p<n+d?1-(p-n)/d*(1-g):p<n+d+r?g:p<E-u?(E-p-u)/l*g:0),y=u?y/2+(u>p?0:(p<E-u?1:(E-p)/u)*x[p-u|0]/2):y),A=(t+=a+=c)*Math.sin(w*q-b),B+=A-A*f*(1-1e9*(Math.sin(p)+1)%2),w+=A-A*f*(1-1e9*(Math.sin(p)**2+1)%2),C&&++C>Y&&(t+=s,m+=s,C=0),!N||++k%N||(t=m,a=F,C=C||1);return x},H=.3,P=44100,J=new(window.AudioContext||webkitAudioContext),I=[];function S(e){const M=function(e){const M="A".charCodeAt(0),t=[],n=parseInt(e.match(/^\d+/)[0],10);e=e.replace(/^\d+/,"");for(let n=0;n<e.length;++n){const r=e[n].charCodeAt(0)-M,l=Math.floor(r/12),i=r%12+1;t.push(...Array(i).fill(l))}return{pixels:t,imageWidth:n}}(t[e].r);I=M.pixels;const n=function(e,M){const t=[];for(let n=0;n<e.length;n+=M)t.push(e.slice(n,n+M));return t}(M.pixels,M.imageWidth),r=function(e,M,t){const n=[],r=e.length,l=e[0].length;for(let i=0;i<r;i+=t)for(let r=0;r<l;r+=M){const l=[];for(let n=0;n<t;n++)l.push(e[i+n].slice(r,r+M));n.push(l)}return n}(n,16,16);return r}function X(e){switch(e){case"+":return 1;case"*":return 2;case"/":return 3;default:return 0}}function Q(e){return Object.keys(t)[e.charCodeAt(0)-"A".charCodeAt(0)]}function K(e){let M="",t="",n="",r=0;for(let e=1;e<=i-2;e++)for(let i=1;i<=l-2;i++){const l=Me(i,e),o=R(l?.tile),a=j(l?.o);o===t&&a===n?++r:(M+=t+n,r>1&&(M+=`${r}`),t=o,n=a,r=1)}return M+=t+n,r>1&&(M+=`${r}`),M=M.replace(/-[0-9]+$/,""),M}function Q(e){return Object.keys(t)[e.charCodeAt(0)-"A".charCodeAt(0)]}function R(e){if(!e)return"-";const M=Object.keys(t).indexOf(e);return String.fromCharCode("A".charCodeAt(0)+M)}function j(e){return{1:"+",2:"*",3:"/"}[e]||""}function T(){E.clearRect(0,0,A.width,A.height),"menu"===b&&function(){E.fillStyle="black",E.fillRect(0,0,A.width,A.height);const e=50,M=100,t=20;_e=[],We.forEach(((n,r)=>{const l=M+r*t,i=r===$e;g.text({ctx:E,x:e,y:l,scale:3,text:n.text,color:i?"rgb(255,255,0)":n.isDisabled?"rgb(150,150,150)":"rgb(255,255,255)"}),_e.push({x:e-10,y:l-10,width:200,height:20,action:n.action,isDisabled:n.isDisabled})}))}(),"editor"===b&&(z(C),Te()),"game"===b&&(z(C),function(){Z.fillStyle="#333",Z.fillRect(0,0,d.width,d.height),g.text({ctx:Z,x:10,y:7,text:"STEPS:",color:"rgb(255,255,255)"});let e=0,M=0;if(Pe>=10){const t=Pe-9;e=ae(t),M=ae(t)}g.text({ctx:Z,x:40+e,y:7+M,text:`${Pe}`,color:ce(Pe)});const n=t.key.tiles[0],r=t.key.co||["#000","#f00","#0f0","#00f"];W(n,r,4.5,.2,{context:Z}),g.text({ctx:Z,x:120,y:7,text:`LEVEL: ${C+1}`,color:"rgb(255,255,255)"}),g.text({ctx:Z,x:90,y:7,text:`x${x}`,color:"rgb(255,255,255)"}),g.text({ctx:Z,x:270,y:7,text:"R: RESET",color:"rgb(255,255,255)"})}(),function(){const e=t.characters.tiles[me],M=t.characters.co;W(e,M,de,Ze,{scale:qe,flipHorizontally:he===f})}())}function z(e){E.drawImage(L,0,0,A.width,A.height),V(u[e].levelData)}function U(e,M){const n=t[e].tiles[0],r=t[e].co,o=t[M].tiles[0],a=t[M].co;for(let e=0;e<i;e++)for(let M=0;M<l;M++)W(n,r,M,e),0!==M&&M!==l-1&&0!==e&&e!==i-1||W(o,a,M,e);V(u[C].levelData,!0),F.drawImage(A,0,0,L.width,L.height)}function V(e,M=!1){e.forEach((e=>{const n=t[e.tile];if("game"==b&&(M&&!n.iS||!M&&n.iS))return;W(n.tiles[e.animationFrame||0],e.color||t[e.tile].co,e.x,e.y,{o:e.o||N,scale:e.scale||1})}))}function W(e,M,t,r,l={}){const{o:i=N,scale:o=e.scale||1,context:a=E,flipHorizontally:c=!1,alpha:s=1}=l;a.save();const Y=n*m/2;a.translate(Math.floor((t+.5)*n*m),Math.floor((r+.5)*n*m));let f=1;c&&(f=-1),a.scale(o*f,o),a.rotate(i*Math.PI/2),a.translate(-Y,-Y);for(let t=0;t<e.length;t++)for(let n=0;n<e[t].length;n++){const r=e[t][n];r>0&&(a.fillStyle=M[r-1],a.globalAlpha=s,a.fillRect(n*m,t*m,m,m))}a.restore()}function $(e){C=e,U("sand","rock"),u[C].initialData=JSON.parse(JSON.stringify(u[C].levelData)),Pe=0,_()}function _(){ue=u[C].characterInitialX,ge=u[C].characterInitialY,de=ue,Ze=ge,Se(q),qe=1}function ee(e,M){return e>=1&&e<l-1&&M>=1&&M<i-1}function Me(e,M,t=[],n=C){let r=null,l=u[n].levelData;for(const n of l)n.x===e&&n.y===M&&(t.length>0?t.includes(n.tile)&&(r=n):r=n);return r}function te(e,M,t){u[C].levelData=u[C].levelData.filter((n=>n.tile!==e||n.x!==M||n.y!==t))}function ne(e,M,t,n={}){u[C].levelData[n.isUnder?"unshift":"push"]({tile:e,x:M,y:t,...n})}function re(e,M,t,n,r){let i=1;"boulder"===e&&(i=l);let o=0;for(;o<i;){let e=M+(o+1)*n,l=t+(o+1)*r,i=Me(e,l)?.tile||null;if(!ee(e,l)||null!==i&&!["arrow","h","trap","hF"].includes(i))break;o++}if(o>0){let l=u[C].levelData;for(const i of l)if(i.x===M&&i.y===t&&i.tile===e){le(i,M+o*n,t+o*r);for(let M=1;M<o;M++)setTimeout((()=>{Re(e)}),c*M);return!0}}return!1}function le(e,M,t){Ae=e,se=e.x,Ye=e.y,Ne=M,fe=t,Ee=0}function ie(e,M,t,n){oe("bT",e,M),oe("block",e,M),Re("block");const r=e+t,l=M+n,i=Me(r,l)?.tile;if("block"===i){const e=u[C].levelData.find((e=>e.x===r&&e.y===l&&"block"===e.tile));if(e){const M=e.o||N;let t=0,n=0;M===h?t=-1:M===f?t=1:M===N?n=-1:M===q&&(n=1),setTimeout((()=>{ie(r,l,t,n)}),120)}}}function oe(e,M=null,t=null,n,r=a){u[C].levelData.filter((n=>n.tile===e&&(null===M||n.x===M&&n.y===t))).forEach((e=>{e.isBeingRemoved=!0,e.scale=1,e.elapsed=0,e.removalDuration=r,e.removeCallback=n}))}function ae(e){const M=.5*e;return Math.random()*M-M/2}function ce(e){return e<11?"rgb(255, 255, 255)":e<12?"rgb(255, 255, 0)":e<13?"rgb(255, 165, 0)":"rgb(255, 0, 0)"}!function(){for(const e in t)t[e].tiles=S(e)}();let se,Ye,Ne,fe,qe,he,ue,ge,de,Ze,Ae=null,Ee=0;function Le(e,M,t,n,r){let l=!1;switch(r?.tile){case"c":case"boulder":re(r?.tile,e,M,t,n)&&(l=!0);break;case"lock":x>0&&(l=!0,oe("lock",e,M,(()=>{x--})));break;case"bT":const i=r.o||N;(i===h&&-1===t||i===f&&1===t||i===N&&-1===n||i===q&&1===n)&&(ie(e,M,t,n),l=!0);break;case"gong-trigger":r.triggered||(r.triggered=!0,l=!0,oe("gong"))}return l}function Fe(e){if(e){const M=p.indexOf(e);-1!==M&&p.splice(M,1)}"r"===event.key&&(u[C].levelData=JSON.parse(JSON.stringify(u[C].initialData)),_(),Pe=0,B=[]),Ke=!1}function be(e){switch(e){case"ArrowUp":case"z":case"w":return"up";case"ArrowDown":case"s":return"down";case"ArrowLeft":case"q":case"a":return"left";case"ArrowRight":case"d":return"right";default:return null}}let me,xe,Be,we,pe,Ce,ke,Oe,ye=!1,ve=de,De=Ze,Ge=de,He=Ze,Pe=0;function Je(e,M,t){if(Be||ye||Ae)return;const n=de+e,l=Ze+M;let i=he;Se(t),function(e,M,t=0,n=0){if(Ae||ye||Be)return!1;if(!ee(e,M))return Re("wall"),!1;const r=Me(e,M),l=r?.tile||null;if(r&&r.isBeingRemoved)return!1;let i=Le(e,M,t,n,r);return i&&Re(l),!![null,"arrow","key","kH","f","trap","h","hF","spawn","spawn-current"].includes(l)||(i?(++Pe,Ke=!0,Qe(de,Ze,i)):Re("wall"),!1)}(n,l,e,M)&&(Pe<r&&(ye=!0,ve=de,De=Ze,Ge=n,He=l,xe=0,B.push({x:de,y:Ze,o:i})),Pe=Math.min(Pe+1,r))}function Ie(e=null,M=null){Be=!0,pe=de,Ce=Ze,ke=e||ue,Oe=M||ge,we=performance.now()}function Se(e){he=e,me=Xe(he)}function Xe(e){switch(e){case N:return 2;case f:case h:return 1;case q:return 0}}function Qe(e,M,t){const n=Me(e,M,["trap"]);if("trap"===n?.tile)t||(Re("trap"),n.tile="h");const l=Me(de,Ze);switch(l?.tile){case"h":Ie(B[B.length-1].x,B[B.length-1].y),--Pe;break;case"f":return $(C+1),!1;case"spawn-current":Pe=0;break;case"spawn":Me(ue,ge).tile="spawn",l.tile="spawn-current",l.animationFrame=0,l.elapsed=0,ue=de,ge=Ze,Pe=0;break;case"key":te("key",de,Ze),Re("key"),++x}Pe>=r&&(Ie(),setTimeout((()=>{Pe=0}),Y))}window.addEventListener("keydown",(e=>{const M=be(event.key);"game"===b&&function(e){e&&!p.includes(e)&&p.push(e)}(M),"menu"===b&&function(e,M){switch(e){case"up":$e=($e-1+We.length)%We.length,We[$e].isDisabled&&($e=($e-1+We.length)%We.length);break;case"down":$e=($e+1)%We.length,We[$e].isDisabled&&($e=($e+1)%We.length)}if("Enter"===M.key){const e=We[$e];e.isDisabled||eM(e.action)}}(M,e),"Escape"===e.key&&Ve("menu")})),window.addEventListener("keyup",(e=>{const M=be(e.key);"game"===b&&Fe(M)})),A.addEventListener("mousemove",(e=>{e.preventDefault();const M=A.getBoundingClientRect(),t=e.clientX-M.left,r=e.clientY-M.top;"menu"===b&&_e.forEach(((e,M)=>{t>=e.x&&t<=e.x+e.width&&r>=e.y&&r<=e.y+e.height&&(e.isDisabled||($e=M))})),"editor"===b&&(y.x=Math.floor(t/(n*m)),y.y=Math.floor(r/(n*m)),Te(),je&&ze(e))})),A.addEventListener("mousewheel",(e=>{if(e.preventDefault(),"editor"===b){const M=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));O.value=(parseInt(O.value)+M+4)%4,Te()}})),A.addEventListener("mousedown",(e=>{je=!0,"editor"===b&&ze(e)})),A.addEventListener("click",(e=>{"menu"===b&&function(e){const M=A.getBoundingClientRect(),t=e.clientX-M.left,n=e.clientY-M.top;_e.forEach((e=>{t>=e.x&&t<=e.x+e.width&&n>=e.y&&n<=e.y+e.height&&(e.isDisabled||eM(e.action))}))}()})),window.addEventListener("mouseup",(e=>{je=!1}));let Ke=!1;function Re(e){switch(e){case"gong-trigger":v(...[,0,523.2511,.02,,1.5,1,.5,-.05,.5,,,.3,.05,,,.05,.8,,.05]);break;case"block":v(...[,0,146.8324,.1,,0,,,,,,,,4,,,,0,.2]);break;case"boulder":v(...[,0,73.41619,.1,,0,,,,,,,,4,,,,0,.2]);break;case"c":v(...[,0,146.8324,.05,,.05,,1.3,,,,,,3]);break;case"key":v(...[,0,1320,,.06,.3,1,,,,880,.06]);break;case"lock":v(...[,0,440,.1,,,1,.3,,,-110,.15,,,,,,,.1]);break;case"trap":v(...[.5,0,440,.08,,.2,4,2,,,,,,5]);break;case"wall":Ke||(Ke=!0,v(...[,0,440,.15,.01,.12,1,1.59,-6.98,4.97]))}}let je=!1;function Te(){const e=k.value,M=parseInt(O.value);W(t[e].tiles[0],t[e].co,y.x,y.y,{o:t[e].cCO?M:N,scale:1,flipHorizontally:!1,alpha:.5})}function ze(e){if(1===e.buttons){if(!Me(y.x,y.y)&&ee(y.x,y.y)){ne(k.value,y.x,y.y,{o:t[k.value].cCO?parseInt(O.value):N});K(u[C].levelData)}}else if(2===e.buttons){te(k.value,y.x,y.y);K(u[C].levelData)}}function Ue(){m=Math.min(Math.floor(window.innerWidth/(l*n)),Math.floor(.89*window.innerHeight/(i*n))),A.width=l*n*m,A.height=i*n*m,d.width=A.width,d.height=1.1*n*m,window.innerWidth/window.innerHeight>l/i?(L.width=window.innerWidth,L.height=window.innerWidth*(i/l)):(L.height=window.innerHeight,L.width=window.innerHeight*(l/i))}function Ve(e){document.body.classList.remove(b),document.body.classList.add(e),b=e,"game"===b&&(E.imageSmoothingEnabled=!1,$(C)),"editor"===b&&(C=0,$(C),Object.keys(t).forEach((e=>{if(0!==t[e].limit){let M=document.createElement("option");M.value=e,M.text=e,k.appendChild(M)}})))}window.addEventListener("resize",(()=>{Ue(),U("sand","rock")})),Ue(),Ve(b),requestAnimationFrame((function e(M){!function(e){if(u[C].levelData.forEach((M=>{if(t[M.tile].tiles.length>1){M.elapsed=(M.elapsed||0)+e;const n=o[M.tile];M.elapsed>=n&&(M.animationFrame=(M.animationFrame+1)%t[M.tile].tiles.length||0,M.elapsed=0)}if(M.isBeingRemoved){M.elapsed=(M.elapsed||0)+e;const t=M.removalDuration||a;M.scale=Math.max(1-M.elapsed/t,0),M.scale<=0&&(te(M.tile,M.x,M.y),M.removeCallback&&M.removeCallback())}})),!ye&&!Be&&p.length>0){switch(p[p.length-1]){case"up":Je(0,-1,N);break;case"down":Je(0,1,q);break;case"left":Je(-1,0,h);break;case"right":Je(1,0,f)}}ye&&function(e){xe+=e;const M=Math.min(xe/s,1);de=ve+(Ge-ve)*M,Ze=De+(He-De)*M;let t=Xe(he);switch(Math.floor(3*M)){case 0:me=t+3;break;case 1:me=t;break;case 2:me=t+6}M>=1&&(ye=!1,de=Ge,Ze=He,xe=0,me=t,Qe(ve,De))}(e);Ae&&function(e){Ee+=e;const M=Math.abs(se-Ne)+Math.abs(Ye-fe);let t=c*M;const n=Math.min(Ee/t,1);if("boulder"===Ae.tile){const e=4,t=M*e,r=Math.floor(n*t)%e;Ae.o=r}Ae.x=se+(Ne-se)*n,Ae.y=Ye+(fe-Ye)*n,n>=1&&(Ae.x=Ne,Ae.y=fe,Ee=0,"c"===Ae.tile&&function(e){const M=Me(e.x,e.y,["h","trap"]);M&&(te(M.tile,e.x,e.y),te("c",e.x,e.y),ne("hF",e.x,e.y,{isUnder:!0}),Re("fall"))}(Ae),Ae=null)}(e)}(M-w),Be&&function(){const e=performance.now()-we,M=Math.min(e/Y,1);M<.5?(qe=1-2*M,de=pe,Ze=Ce):(qe=2*(M-.5),de=ke,Ze=Oe,ke===ue&&Oe===ge&&Se(q));M>=1&&(Be=!1,de=ke,Ze=Oe,qe=1)}(),T(),w=M,requestAnimationFrame(e)}));const We=[{text:"CONTINUE",action:"continue",isDisabled:!0},{text:"NEW GAME",action:"newGame",isDisabled:!1},{text:"LEVEL EDITOR",action:"levelEditor",isDisabled:!1}];let $e=1,_e=[];function eM(e){switch(e){case"continue":b="game";break;case"newGame":Ve("game");break;case"levelEditor":Ve("editor")}}}();</script></div></body></html>