<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>13 steps to death</title><style>body,
      html {
        margin: 0;
        padding: 0;
        overflow: hidden;
        height: 100%;
        width: 100%;
      }

      #game {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }

      #gameBackgroundCanvas {
        position: absolute;
        top: -5%;
        left: -5%;
        width: 110%;
        height: 110%;
        z-index: -1; /* Behind the main canvas */
        object-fit: cover;
        filter: blur(15px) brightness(50%); /* Apply blur and darken the background */
      }</style></head><body style="overflow: hidden"><div id="game"><canvas id="gameBackgroundCanvas"></canvas><canvas id="uiCanvas"></canvas><canvas id="gameCanvas"></canvas></div><script>"use strict";const IMAGE_LIST={arrow:"16LKZLA\\K^LZLBZLBZLLLLLLLLLLLLG",block:"16AXNAMYezeYNZnZNedeNqeYlYeqNqeYgNgYeqNqeYfMeYMfYeqNqeYfMeYMfYeqNqeYeMfZMeYeqNqeYeMeNYMeYeqNqeYeNfNeYeqNqeYlYeqNedeNZnZNYezeYMAXNA",characters:"144FPKQLPLLLLLLLLJNhNGNiNHNhNJPKQLPLPKQLPIMlMEMmMFMlMGNhNGNiNHNhNHNhNGNiNHNhNGMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMesereMEMeugMFMlMFMlMEMmMFMlMFMlMEMmMFMlMEMqeveqMEMufNEMqlqMEMereseMEMeugMFMlMFMereseMEMeugMFMlMFMrMrMrMFMqMseMqMFMlMEMqeveqMEMufNEMqlqMDMqeveqMEMufNEMqlqMFMqMrMqMGMqMuMHMjMGMrMrMrMFMqMseMqMFMlMFMrMrMrMFMqMseMqMFMlMFOtOGMtNHOtOFNqMrMqNFMqMuMHNhNGNqMrMqNFMqMuMHNhNFM[P[MGPYMGM[P[MDMZMtMZMFMtNHMZPZMEMZMtMZMFMtOGMZPZMDMZMZrZMZMFN[MFMZM^MZMCOYPYMYqMEQYNFMqM^OCMqYMYPYOFQ[MEO^MqMCMZM^MZMFMYMZMFMZM^MZMCMrM]NqMDMr\\MqMFN]MrMCMqN]MrMEMqNZMYqMEMrM]NEMqTqMGMYMqNGMqTqMEUANEO\\MHUDNAUGN\\MqMFUGN^NHOqMIN^NHMqNZMISHMZNqMIMZNqMJSIMqNZMHMrNrMIMrNJMrNrMJOrMHMrNrMHMrOJMrOJMrNrMJOrMJPKQLPLLLLLLLLJNhNGNiNHNhNJPKQLPLPKQLPIMlMEMmMFNjNGNhNGNiNHNhNHNhNGNiNHNhNGMlMEMmMFMlMFMlMEMmMFNjNFMlMEMmMFNjNFMgqhMEMmMFMlMFMlMEMmMFMlMFMlMEMmMFMlMFMeveMEMerjMFMlMFMgqhMEMmMFMlMFMgqhMEMmMFMlMEMqeveqMEMshMeMDMqlqMEMeveMEMerjMFMlMFMeveMEMerjMFMlMFMeqMrMqeMFMqMqgMqMeMDMgNgMEMqeveqMEMshMeMDMqlqMDMqeveqMEMshMeMDMqlqMFMqMrMqMGMqMqfrMfMEMeMfMeMGMeqMrMqeMFMqMqgMqMeMDMgNgMFMeqMrMqeMFMqMqgMqMeMDMgNgMGNtNHMtNfMFNhNHMqMrMqMGMqMqfrMfMEMeMfMeMHMqMrMqMGMqMqfrMfMEMeMfMeMGMZPZMHSeMEMYMhMYMFMYMtMYMGMtNfMEMYMhMYMFMYMtMYMGMtNfMEMYMhMYMFM[r[MGMYNYMANFMZMfMZMFMYQYNHSfMDMYMgPFNYQYMGTfMDMYNgOEMqN\\NqMFMZMqMHMqNYNYNqMEO\\MrMFMZqNqODMrNeQEMrM\\OGM[MrOEQeNrMCMrN\\NrMFMYMqMGMrN\\NrMCMrM\\PFMsPFPYNYMrMDP\\MrMEMqMZNqMFMrMYNYPDOrNrOGMrNHOrNrOEOqNrMIOYqMIMrNqOGMrNqOGMrNYNGOqNrMIMqNqMKMqMLMqNqMKOqMJMqNqMJMqOKMqOJMqOqMKOqME",crate:"16AXNANYnYOZVZNeNeqjNeNeMfqetfMeNeMfteqfMeNeNjqeNeNZVZOYnYOYXYO[MZM]OYNYMYNYPYNYMZMYNYMZMYNYPYNYMYNYO]MZM[NAXNA",flag:"48DYLCYLCYLBZLBZLBZLCMgLMlGMlGMkHMkHMkHMkHMkHMkHMkHMkHMkHMkHMlGMkHMFfGMLCMChHMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLCMLBZLBZLBZK","gong-trigger":"16XQsevesNqfTfqNfOhNgNfNeteNfNfMeqPqeMfMAMeMeqMrMqeMeMBMeMeqPqeMeMBMeNeteNeMBMeMAMhMAMeMBMeMBPBMeMBMeMHMeMBMeMHMeMBMeMAQBMeMBMeMBQAMeMBOHOA",gong:"16F\\JZtZGYfvYEZe^rYC\\jYrYB[lYqYBZnZBYhthYBYgq\\qgYBYgqYrYqgYBYgq\\qgYBZgtgZBeZlZeCeZjZeEe`eGlD","hole-filled":"16LLLAMANAMFXNANYnYOZVZNeNeqjNeNeMfqetfMeNeMfteqfMeNeNjqeNeNZVZOYnYOYXYMAM[MZM]MCMAYMYNYNAMLF",hole:"16LLLYA\\AYGbEYA`AYDdCYAbAYB\\MYNYM\\A\\MYMZMYM\\AZMYMYNYMYMZCZTZCZMYRYMZCZTZEYTYHRLI","key-holder":"16LFdCYpYAZ{e\\qbe\\qYeYhYeYe\\qZfZfZe\\qYgZgYe\\qYgYhYe\\qZfZfZe\\qYeYhYeYe\\qbe\\oq[edqZpfYAdZA",key:"16FtKqPqIqMhMqHqMYNeMqHqMYNeMqHqM\\MqIqNYMqJqMeYMqJqNYMqJqMZMqKqNqLArLLLLLK",lock:"16FPKMtMIMq\\qMGMZhYqMEMZeqNYeYqMCNYeqPYeYqMAOYeqPYeYrPYfqNYfYrO[eqNYeYfqMYM\\ereYgMYAYM\\fYgMYCYM[MYgMYEYMYMfYeMYGYMhMYIYPYK\\F",rock:"16FPIOhNFMeresfMDMerYeueMCMfqZesfqMBMgqZgYfMBMiYgZNBNYkZqNBNYiZsMBMqgriqMAMqeqYgqMYgMAMYfqMYeqMYgMAMZeqMYfNYfMAOZNYPYMqBPEOLF",sand:"16ZMYV]MYV]MYW\\MYMYU^MYU^MZU^MZV]MYV]XM\\XM\\X[XN[XM\\X]XZ",trap:"16DNANANGVEQrQCNYM[N[NBMqMrYrMrMqMANZM\\q\\OqMrMYsMrMqO]N]OsNsMqYsN\\qYM]qYOqMqOsYrNAqZN[M[MqBNYqMsMrOCO[rZNFQrMJPF"},TILE_SIZE=16;let zoomFactor=1;const LEVEL_WIDTH=20,LEVEL_HEIGHT=10,MAX_STEPS_ALLOWED=13,RESPAWN_RESET_DELAY=500,uiCanvas=document.getElementById("uiCanvas"),uiCtx=uiCanvas.getContext("2d"),canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),backgroundCanvas=document.getElementById("gameBackgroundCanvas"),backgroundCtx=backgroundCanvas.getContext("2d");let backgroundTile,backgroundColors,collectedKeysNumber=0;const ORIENTATION_UP=0,ORIENTATION_RIGHT=1,ORIENTATION_DOWN=2,ORIENTATION_LEFT=3,DEFAULT_ANIMATION_INTERVAL=200,DEFAULT_REMOVAL_DURATION=225,COLOR_SETS={blueGreenSet:["#024d53","#599dbc","#72d1c7","#a9ffe6"],crateSet:["#000","#893a25","#f89e61","#863422"],greenSet:["#000","#527f67","#a2ce69","#d6f8e1"],sandSet:["#cab168","#e5d09e"],bronzeSet:["#000","#811c07","#ca6137","#ffb59c"]},DEFAULT_TILE_COLORS={arrow:COLOR_SETS.blueGreenSet,block:COLOR_SETS.blueGreenSet,character:["#000","#e42c37","#c07548","#fdcbb0"],crate:COLOR_SETS.crateSet,lock:COLOR_SETS.greenSet,key:COLOR_SETS.greenSet,flag:COLOR_SETS.bronzeSet,"key-holder":COLOR_SETS.blueGreenSet,rock:COLOR_SETS.blueGreenSet,sand:COLOR_SETS.sandSet,gong:COLOR_SETS.bronzeSet,"gong-trigger":COLOR_SETS.bronzeSet};let levelData=[{tile:"arrow",x:4,y:7},{tile:"arrow",x:4,y:6,orientation:ORIENTATION_LEFT},{tile:"arrow",x:2,y:4,orientation:ORIENTATION_LEFT},{tile:"crate",x:3,y:6},{tile:"crate",x:4,y:6},{tile:"rock",x:11,y:2},{tile:"rock",x:1,y:3},{tile:"rock",x:2,y:3},{tile:"rock",x:3,y:3},{tile:"rock",x:4,y:3},{tile:"rock",x:5,y:3},{tile:"rock",x:6,y:3},{tile:"rock",x:7,y:3},{tile:"rock",x:12,y:3},{tile:"rock",x:13,y:3},{tile:"rock",x:14,y:3},{tile:"rock",x:15,y:3},{tile:"rock",x:16,y:3},{tile:"rock",x:17,y:3},{tile:"rock",x:18,y:3},{tile:"rock",x:4,y:4},{tile:"rock",x:5,y:4},{tile:"rock",x:14,y:4},{tile:"rock",x:16,y:4},{tile:"rock",x:1,y:5},{tile:"rock",x:2,y:5},{tile:"rock",x:5,y:5},{tile:"rock",x:14,y:5},{tile:"rock",x:16,y:5},{tile:"block",x:8,y:3,orientation:ORIENTATION_LEFT},{tile:"block",x:9,y:3,orientation:ORIENTATION_LEFT},{tile:"flag",x:9,y:2},{tile:"block",x:10,y:3,color:COLOR_SETS.greenSet,orientation:ORIENTATION_LEFT,isPushable:!0},{tile:"lock",x:11,y:3},{tile:"key-holder",x:15,y:4},{tile:"key",x:15,y:4},{tile:"gong-trigger",x:1,y:4},{tile:"gong",x:15,y:5}],zzfx=(...e)=>zzfxP(zzfxG(...e)),zzfxP=(...e)=>{let M=zzfxX.createBufferSource(),t=zzfxX.createBuffer(e.length,e[0].length,zzfxR);return e.map(((e,M)=>t.getChannelData(M).set(e))),M.buffer=t,M.connect(zzfxX.destination),M.start(),M},zzfxG=(e=1,M=.05,t=220,r=0,a=0,n=.1,o=0,c=1,i=0,l=0,N=0,s=0,E=0,h=0,Y=0,T=0,q=0,f=1,L=0,u=0)=>{let O,d,g=2*Math.PI,I=i*=500*g/zzfxR**2,A=(0<Y?1:-1)*g/4,m=t*=(1+2*M*Math.random()-M)*g/zzfxR,F=[],S=0,C=0,v=0,R=1,k=0,_=0,x=0;for(l*=500*g/zzfxR**3,Y*=g/zzfxR,N*=g/zzfxR,s*=zzfxR,E=zzfxR*E|0,d=(r=99+zzfxR*r)+(L*=zzfxR)+(a*=zzfxR)+(n*=zzfxR)+(q*=zzfxR)|0;v<d;F[v++]=x)++_%(100*T|0)||(x=o?1<o?2<o?3<o?Math.sin((S%g)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/g%2+2)%2:1-4*Math.abs(Math.round(S/g)-S/g):Math.sin(S),x=(E?1-u+u*Math.sin(2*Math.PI*v/E):1)*(0<x?1:-1)*Math.abs(x)**c*e*zzfxV*(v<r?v/r:v<r+L?1-(v-r)/L*(1-f):v<r+L+a?f:v<d-q?(d-v-q)/n*f:0),x=q?x/2+(q>v?0:(v<d-q?1:(d-v)/q)*F[v-q|0]/2):x),O=(t+=i+=l)*Math.sin(C*Y-A),S+=O-O*h*(1-1e9*(Math.sin(v)+1)%2),C+=O-O*h*(1-1e9*(Math.sin(v)**2+1)%2),R&&++R>s&&(t+=N,m+=N,R=0),!E||++k%E||(t=m,i=I,R=R||1);return F},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),pixelList=[];function decodeRLE(e){const M="A".charCodeAt(0),t=[],r=parseInt(e.match(/^\d+/)[0],10);e=e.replace(/^\d+/,"");for(let r=0;r<e.length;++r){const a=e[r].charCodeAt(0)-M,n=Math.floor(a/12),o=a%12+1;t.push(...Array(o).fill(n))}return{pixels:t,imageWidth:r}}function convertTo2DArray(e,M){const t=[];for(let r=0;r<e.length;r+=M)t.push(e.slice(r,r+M));return t}function sliceIntoTiles(e,M,t){const r=[],a=e.length,n=e[0].length;for(let o=0;o<a;o+=t)for(let a=0;a<n;a+=M){const n=[];for(let r=0;r<t;r++)n.push(e[o+r].slice(a,a+M));r.push(n)}return r}function processSprite(e){const M=decodeRLE(IMAGE_LIST[e]);pixelList=M.pixels;return{tiles:sliceIntoTiles(convertTo2DArray(M.pixels,M.imageWidth),16,16)}}function processAllSprites(){const e=[];for(const M in IMAGE_LIST)e[M]=processSprite(M);return e}const GAME_SPRITES=processAllSprites(),initialLevelData=JSON.parse(JSON.stringify(levelData));function resetLevel(){levelData=JSON.parse(JSON.stringify(initialLevelData)),levelData.forEach((e=>{GAME_SPRITES[e.tile].tiles.length>1&&(e.animationFrame=0,e.elapsed=0),e.isBeingRemoved=!1,e.scale=1})),characterX=initialX,characterY=initialY,characterScale=1,stepsPerformed=MAX_STEPS_ALLOWED}function getTileAt(e,M){let t=null;for(const r of levelData)r.x===e&&r.y===M&&(t=r.tile);return t}function removeTile(e,M=null,t=null){levelData=levelData.filter((r=>r.tile!==e||null!==M&&null!==t&&(r.x!==M||r.y!==t)))}function moveCrate(e,M,t,r){const a=e+t,n=M+r,o=getTileAt(a,n);if(null===o||["arrow"].includes(o))for(const t of levelData)if(t.x===e&&t.y===M&&"crate"===t.tile)return t.x=a,t.y=n,playActionSound("crate"),!0;return!1}function removeConnectedBlocks(e,M,t,r){animateTileRemoval("block",e,M);const a=e+t,n=M+r;if("block"===getTileAt(a,n)){const e=levelData.find((e=>e.x===a&&e.y===n&&"block"===e.tile));if(e){const M=e.orientation||ORIENTATION_UP;let t=0,r=0;M===ORIENTATION_LEFT?t=-1:M===ORIENTATION_RIGHT?t=1:M===ORIENTATION_UP?r=-1:M===ORIENTATION_DOWN&&(r=1),setTimeout((()=>{removeConnectedBlocks(a,n,t,r)}),120)}}}function animateTileRemoval(e,M=null,t=null,r,a=DEFAULT_REMOVAL_DURATION){levelData.filter((r=>r.tile===e&&(null===M||r.x===M&&r.y===t))).forEach((e=>{e.isBeingRemoved=!0,e.scale=1,e.elapsed=0,e.removalDuration=a,e.removeCallback=r}))}function refreshUI(){drawUI()}function drawUI(){uiCtx.fillStyle="#333",uiCtx.fillRect(0,0,uiCanvas.width,uiCanvas.height),adjustFontSize(`Steps: ${stepsPerformed}`),uiCtx.fillStyle="white";const e=uiCanvas.height/2+uiCtx.font.match(/\d+/)[0]/2;uiCtx.fillText(`Steps: ${stepsPerformed}`,.02*uiCanvas.width,e);drawTile(GAME_SPRITES.key.tiles[0],DEFAULT_TILE_COLORS.key,4.5,.75,{context:uiCtx}),uiCtx.fillText(`x${collectedKeysNumber}`,.28*uiCanvas.width,e),uiCtx.fillText("R: Reset",.8*uiCanvas.width,.7*e),uiCtx.fillText("Undo",.8*uiCanvas.width,1.3*e)}function adjustFontSize(e){let M=e.length;for(uiCtx.font="40px Arial";uiCtx.measureText(e).width>uiCanvas.width*M*.02;)uiCtx.font=parseInt(uiCtx.font)-1+"px Arial"}function refreshCanvas(){drawLevel(),refreshUI(),drawCharacter()}function drawLevel(){drawLevelBackground("sand","rock"),drawLevelElements(levelData),backgroundCtx.drawImage(canvas,0,0,backgroundCanvas.width,backgroundCanvas.height)}function drawLevelBackground(e,M){backgroundTile=GAME_SPRITES[e].tiles[0],backgroundColors=DEFAULT_TILE_COLORS[e];const t=GAME_SPRITES[M].tiles[0],r=DEFAULT_TILE_COLORS[M];for(let e=0;e<LEVEL_HEIGHT;e++)for(let M=0;M<LEVEL_WIDTH;M++)drawTile(backgroundTile,backgroundColors,M,e),0!==M&&M!==LEVEL_WIDTH-1&&0!==e&&e!==LEVEL_HEIGHT-1||drawTile(t,r,M,e)}function drawLevelElements(e){e.forEach((e=>{drawTile(GAME_SPRITES[e.tile].tiles[e.animationFrame||0],e.color||DEFAULT_TILE_COLORS[e.tile],e.x,e.y,{orientation:e.orientation||ORIENTATION_UP,scale:e.scale||1})}))}function drawTile(e,M,t,r,a={}){const{orientation:n=ORIENTATION_UP,scale:o=1,context:c=ctx,flipHorizontally:i=!1}=a;c.save();const l=TILE_SIZE*zoomFactor/2;c.translate((t+.5)*TILE_SIZE*zoomFactor,(r+.5)*TILE_SIZE*zoomFactor);let N=1;i&&(N=-1),c.scale(o*N,o),c.rotate(n*Math.PI/2),c.translate(-l,-l);for(let t=0;t<e.length;t++)for(let r=0;r<e[t].length;r++){const a=e[t][r];a>0&&(c.fillStyle=M[a-1],c.fillRect(r*zoomFactor,t*zoomFactor,zoomFactor,zoomFactor))}c.restore()}const keyStack=[];function handleKeyDown(e){const M=mapKeyToDirection(e.key);M&&!keyStack.includes(M)&&keyStack.push(M)}function handleKeyUp(e){const M=mapKeyToDirection(e.key);if(M){const e=keyStack.indexOf(M);-1!==e&&keyStack.splice(e,1)}}function mapKeyToDirection(e){switch(e){case"ArrowUp":case"z":case"w":return"up";case"ArrowDown":case"s":return"down";case"ArrowLeft":case"q":case"a":return"left";case"ArrowRight":case"d":return"right";default:return null}}window.addEventListener("keydown",handleKeyDown),window.addEventListener("keyup",handleKeyUp);let characterX=9,characterY=7,characterScale=1,characterDirection=ORIENTATION_DOWN,initialX=characterX,initialY=characterY,isCharacterMoving=!1,characterMoveStartX=characterX,characterMoveStartY=characterY,characterMoveTargetX=characterX,characterMoveTargetY=characterY,characterMoveFrame=0;const CHARACTER_MOVE_DURATION=300;let characterMoveElapsedTime=0,stepsPerformed=0;function drawCharacter(){drawTile(GAME_SPRITES.characters.tiles[characterMoveFrame],DEFAULT_TILE_COLORS.character,characterX,characterY,{scale:characterScale,flipHorizontally:characterDirection===ORIENTATION_RIGHT})}function canMoveTo(e,M,t=0,r=0){if(e<1||e>=LEVEL_WIDTH-1||M<1||M>=LEVEL_HEIGHT-1)return playActionSound("wall"),!1;const a=getTileAt(e,M),n=levelData.find((t=>t.x===e&&t.y===M));if(n&&n.isBeingRemoved)return!1;let o=!1;switch(a){case"crate":moveCrate(e,M,t,r)&&(o=!0);break;case"key":o=!0,removeTile("key"),collectedKeysNumber++;break;case"lock":collectedKeysNumber>0&&(o=!0,animateTileRemoval("lock",e,M,(()=>{collectedKeysNumber--})));break;case"flag":return resetLevel(),!1;case"block":const a=levelData.find((t=>t.x===e&&t.y===M&&"block"===t.tile));if(a){const n=a.orientation||ORIENTATION_UP;a.isPushable&&(n===ORIENTATION_LEFT&&-1===t||n===ORIENTATION_RIGHT&&1===t||n===ORIENTATION_UP&&-1===r||n===ORIENTATION_DOWN&&1===r)&&(removeConnectedBlocks(e,M,t,r),o=!0)}break;case"gong-trigger":n.triggered||(n.triggered=!0,o=!0,animateTileRemoval("gong"))}return o&&playActionSound(a),!![null,"arrow","key","key-holder","flag"].includes(a)||(o?++stepsPerformed:playActionSound("wall"),!1)}function moveCharacter(e,M,t){if(isReturningToSpawn||isCharacterMoving)return;const r=characterX+e,a=characterY+M;setCharacterDirection(t),canMoveTo(r,a,e,M)&&(isCharacterMoving=!0,characterMoveStartX=characterX,characterMoveStartY=characterY,characterMoveTargetX=r,characterMoveTargetY=a,characterMoveElapsedTime=0,++stepsPerformed,stepsPerformed>=MAX_STEPS_ALLOWED&&(refreshCanvas(),setTimeout((()=>{isReturningToSpawn=!0,returnStartX=characterX,returnStartY=characterY,characterReturnStartTime=performance.now(),stepsPerformed=0}),RESPAWN_RESET_DELAY)))}function setCharacterDirection(e){characterDirection=e,characterMoveFrame=getMoveFrameFromDirection(characterDirection)}function getMoveFrameFromDirection(e){switch(e){case ORIENTATION_UP:return 2;case ORIENTATION_RIGHT:case ORIENTATION_LEFT:return 1;case ORIENTATION_DOWN:return 0}}let lastFrameTime=0,isReturningToSpawn=!1,characterReturnStartTime=0;const CHARACTER_RETURN_DURATION=250;let returnStartX,returnStartY;function animate(e){updateAnimations(e-lastFrameTime),isReturningToSpawn&&returnCharacterToSpawn(),refreshCanvas(),lastFrameTime=e,requestAnimationFrame(animate)}function updateAnimations(e){if(levelData.forEach((M=>{if(GAME_SPRITES[M.tile].tiles.length>1){M.elapsed=(M.elapsed||0)+e;const t=M.animationInterval||DEFAULT_ANIMATION_INTERVAL;M.elapsed>=t&&(M.animationFrame=(M.animationFrame+1)%GAME_SPRITES[M.tile].tiles.length,M.elapsed=0)}if(M.isBeingRemoved){M.elapsed=(M.elapsed||0)+e;const t=M.removalDuration||DEFAULT_REMOVAL_DURATION;M.scale=Math.max(1-M.elapsed/t,0),M.scale<=0&&(removeTile(M.tile,M.x,M.y),M.removeCallback&&M.removeCallback())}})),!isCharacterMoving&&!isReturningToSpawn&&keyStack.length>0){switch(keyStack[keyStack.length-1]){case"up":moveCharacter(0,-1,ORIENTATION_UP);break;case"down":moveCharacter(0,1,ORIENTATION_DOWN);break;case"left":moveCharacter(-1,0,ORIENTATION_LEFT);break;case"right":moveCharacter(1,0,ORIENTATION_RIGHT)}}isCharacterMoving&&(console.log("Character is moving"),playCharacterAnimation(e))}function playCharacterAnimation(e){characterMoveElapsedTime+=e;const M=Math.min(characterMoveElapsedTime/CHARACTER_MOVE_DURATION,1);characterX=characterMoveStartX+(characterMoveTargetX-characterMoveStartX)*M,characterY=characterMoveStartY+(characterMoveTargetY-characterMoveStartY)*M;let t=getMoveFrameFromDirection(characterDirection);switch(Math.floor(3*M)){case 0:characterMoveFrame=t+3;break;case 1:characterMoveFrame=t;break;case 2:characterMoveFrame=t+6}M>=1&&(isCharacterMoving=!1,characterX=characterMoveTargetX,characterY=characterMoveTargetY,characterMoveElapsedTime=0,characterMoveFrame=t)}function returnCharacterToSpawn(){const e=performance.now()-characterReturnStartTime,M=Math.min(e/CHARACTER_RETURN_DURATION,1);characterX=returnStartX+(initialX-returnStartX)*M,characterY=returnStartY+(initialY-returnStartY)*M;characterScale=M<.5?1-2*M*.6:1-2*(1-M)*.6,M>=1&&(isReturningToSpawn=!1,characterX=initialX,characterY=initialY)}function playActionSound(e){switch(e){case"gong-trigger":zzfx(...[,0,523.2511,.02,,1.5,1,.5,-.05,.5,,,.3,.05,,,.05,.8,,.05]);break;case"crate":zzfx(...[,.1,150,.05,,,,1.3,,,,,,3]);break;case"key":zzfx(...[,0,1320,,.1,.3,1,1.82,,,880,.05]);break;case"wall":zzfx(...[,0,440,.15,.01,.12,1,1.59,-6.98,4.97]);break;default:console.warn(`No sound effect for tile: ${e}`)}}function setZoomFactor(){zoomFactor=Math.min(Math.floor(window.innerWidth/(LEVEL_WIDTH*TILE_SIZE)),Math.floor(window.innerHeight/(LEVEL_HEIGHT*TILE_SIZE))),canvas.width=LEVEL_WIDTH*TILE_SIZE*zoomFactor,canvas.height=LEVEL_HEIGHT*TILE_SIZE*zoomFactor,uiCanvas.width=canvas.width,uiCanvas.height=TILE_SIZE*zoomFactor*2,window.innerWidth/window.innerHeight>LEVEL_WIDTH/LEVEL_HEIGHT?(backgroundCanvas.width=window.innerWidth,backgroundCanvas.height=window.innerWidth*(LEVEL_HEIGHT/LEVEL_WIDTH)):(backgroundCanvas.height=window.innerHeight,backgroundCanvas.width=window.innerHeight*(LEVEL_WIDTH/LEVEL_HEIGHT))}function initGame(){ctx.imageSmoothingEnabled=!1,levelData.forEach((e=>{e.animationFrame=0})),window.addEventListener("resize",setZoomFactor),setZoomFactor(),requestAnimationFrame(animate)}initGame();</script></body></html>